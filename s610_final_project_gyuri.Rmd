---
title: "S610 Final Project"
author: "Gyuri Kang"
output:
  html_document:
    df_print: paged
date: "2024-12-18"
---

## Summary of the Article

The authors conducted network analysis on 30,288 majority opinions written by the U.S. Supreme Court and cited cases from 1754 to 2002 in the _United States Reports_. They observed a significant deviation from the norm of _stare decisis_ by the activist Warren Court. They also identified the most important court precedents by using _authority scores_. According to their analysis of these scores, reversed cases appear to be more important than other decisions, and those cases that override the reversed cases become more important while the reversed decisions decline.

## Data
```{r}
library(xtable)
```

```{r}
judicial_url <- "/Users/gyul/Desktop/IUB/2024-2025/Fall2024/S610/final_project/dataverse_files/Judicial/judicial.csv"

judicial <- read.csv(judicial_url, header = TRUE)

head(judicial)

#xtable(head(judicial))
```

```{r}
allcites_url <- "/Users/gyul/Desktop/IUB/2024-2025/Fall2024/S610/final_project/dataverse_files/Judicial/allcites.txt"

allcites <- read.csv(allcites_url, header = FALSE, sep = " ")

head(allcites)
```

```{r}
authmat_url <- "/Users/gyul/Desktop/IUB/2024-2025/Fall2024/S610/final_project/dataverse_files/Judicial/authmat.txt"

authmat <- read.csv(authmat_url, header = TRUE)

head(authmat)
```

## Fig. 1

```{r}
# cited Roe v. Wade
roe_wade <- subset(allcites, V2 == 25347)
head(roe_wade)
```

```{r}
# landmark abortion decisions
landmark <- subset(judicial,
                   usid %in% c("492US490", "505US833", "476US747", "462US416", "410US113"))

head(landmark)
```

```{r}
roe_wade_cites <- subset(allcites, 
                        V1 %in% c(27633, 28354, 29003, 29459) & 
                        V2 %in% c(25347, 27633, 28354, 29003, 29459))

head(roe_wade_cites)
```

```{r}
edges <- roe_wade_cites

nodes <- data.frame(
  name = c(25347, 27633, 28354, 29003, 29459),
  label = c(
    "Roe v. Wade", 
    "City of Akron v. Akron Ctr.", 
    "Thornburgh v. American College", 
    "Webster v. Reproductive Health", 
    "Planned Parenthood v. Casey"
  )
)
```

```{r}
library(igraph)
```

```{r}
# directed graph
g <- graph_from_data_frame(roe_wade_cites, directed = TRUE)

V(g)$label <- judicial$parties[match(V(g)$name, judicial$caseid)]
```

```{r}
library(ggraph)
```

```{r}
# ggraph visualization
ggraph(g, layout = "fr") +
  geom_edge_link(arrow = arrow(length = unit(4, 'mm')), end_cap = circle(3, 'mm')) +
  geom_node_point(size = 5, color = "lightblue") +
  geom_node_text(aes(label = label), repel = TRUE, size = 3) +
  theme_void()
```

## Fig. 2

```{r}
library(dplyr)
library(ggplot2)
library(ggpubr)
```

```{r}
# total counts of inward and outward citations
inward_counts <- judicial %>%
  count(indeg) %>%
  rename(Citations = indeg, Frequency = n) %>%
  filter(Citations > 0)

outward_counts <- judicial %>%
  count(outdeg) %>%
  rename(Citations = outdeg, Frequency = n) %>%
  filter(Citations > 0)

# inward plot (log-log scale)
inlog <- ggplot(inward_counts,
       aes(x = Citations, y = Frequency)) +
  geom_point(shape = 1) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "Inward Citations", y = "Number of Cases") +
  theme_classic() +
  theme(panel.border = element_rect(
    color = "black", fill = NA)
    )

# outward plot (log-log scale)
outlog <- ggplot(outward_counts,
       aes(x = Citations, y = Frequency)) +
  geom_point(shape = 1) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "Outward Citations", y = "") +
  theme_classic() + 
  theme(panel.border = element_rect(
    color = "black", fill = NA)
    )

# combined plots
fig2 <- ggarrange(inlog, outlog)
fig2
```

## Fig. 3

```{r}
# average inward and outward citations per year
citation_averages <- judicial %>%
  group_by(year) %>%
  summarise(
    avg_inward = mean(indeg, na.rm = TRUE),
    avg_outward = mean(outdeg, na.rm = TRUE)
  )

# average inward plot
inmean <- ggplot(citation_averages,
       aes(x = year, y = avg_inward)) +
  geom_point(shape = 1) +
  labs(y = "Inward Citations") +
  theme_classic() +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        panel.border = element_rect(
          color = "black", fill = NA)
  )

# average outward plot
outmean <- ggplot(citation_averages,
       aes(x = year, y = avg_outward)) +
  geom_point(shape = 1) +
  labs(x = "Year", y = "Outward Citations") +
  theme_classic() +
  theme(panel.border = element_rect(
    color = "black", fill = NA)
    )

# combined plots
fig3 <- ggarrange(inmean, outmean, ncol = 1)
fig3
```

## Fig. 4

```{r}
percentage_outward <- judicial %>%
  group_by(year) %>%
  summarise(
    total_cases = n(),
    cases_with_outward = sum(
      outdeg > 0, na.rm = TRUE),
    percent_outward = (
      cases_with_outward / total_cases) * 100
  )

ggplot(percentage_outward,
       aes(x = year, y = percent_outward)) +
  geom_point(shape = 1, size = 1) +
  labs(
    x = "Year",
    y = "Cases With At Least\n One Outward Citation (%)",
    ) +
  scale_y_continuous(breaks = seq(0, 100, by = 20),
                     limits = c(0, 100)) +
  theme_classic() +
  theme(panel.border = element_rect(
    color = "black", fill = NA)
    )
```

# Figs. 6 & 10

```{r}
library(dplyr)
library(igraph)
library(ggplot2)
library(reshape2)
```

## Merged dataset

```{r}
# Merge the year data for both caseids in allcites
allcites_with_years <- allcites %>%
  left_join(judicial %>% select(caseid, year), by = c("V1" = "caseid")) %>%
  rename(year1 = year) %>%
  left_join(judicial %>% select(caseid, year), by = c("V2" = "caseid")) %>%
  rename(year2 = year)

head(allcites_with_years)
```

## Fig. 6

```{r}
# Create year range and initialize storage lists
year_range <- 1799:2002

# Fig 6
fig6_ids <- c("25347", "21109")

subsets <- list()
authority_scores_by_year <- list()

# Process each year in reverse
for (yr in rev(year_range)) {
  # Subset data for years within the range
  subsets[[as.character(yr)]] <- subset(allcites_with_years, year1 >= 1799 & year1 <= yr)
  complete_subsets <- subsets[[as.character(yr)]]

  # Create graph for the full network
  nodes_complete <- unique(c(complete_subsets$V1, complete_subsets$V2))
  vertices <- data.frame(name = nodes_complete)
  g_complete <- graph_from_data_frame(complete_subsets, directed = TRUE, vertices = vertices)

  # Run HITS algorithm
  hits_result_complete <- authority_score(g_complete)

  # Authority scores
  authority_scores_complete <- hits_result_complete$vector

  # Normalize authority scores
  normalized_authority_complete <- authority_scores_complete / sqrt(sum(authority_scores_complete^2, na.rm = TRUE))

  # Store scores for the year
  authority_scores_by_year[[as.character(yr)]] <- normalized_authority_complete

  # Display specific case IDs' authority scores for the year
  if (all(fig6_ids %in% names(normalized_authority_complete))) {
    cat(sprintf("\nYear: %d\n", yr))
    print(normalized_authority_complete[fig6_ids])
  }
}
```

```{r}
# Combine authority scores into a data frame for plotting
authority_scores_df <- do.call(rbind, lapply(names(authority_scores_by_year), function(year) {
  scores <- authority_scores_by_year[[year]]
  data.frame(
    year = as.numeric(year),
    case_id = names(scores),
    authority_score = scores
  )
}))

# Filter for the specific case IDs of interest
filtered_df <- authority_scores_df[authority_scores_df$case_id %in% fig6_ids, ]

# Adjust the years after decision
years_since_decision <- list("25347" = 1973, "21109" = 1954)
filtered_df$years_after <- filtered_df$year - sapply(filtered_df$case_id, function(id) years_since_decision[[id]])

# Plot authority scores over time
ggplot(filtered_df, aes(x = years_after, y = authority_score, linetype = case_id)) +
  geom_line() +
  labs(
    title = "",
    x = "Years After Decision",
    y = "Authority Score"
  ) +
  annotate("text", x = 2, y = 0.06, label = "Roe v. Wade,\n310 U.S. 113 (1973)", fontface = "italic", hjust = 0) +
  annotate("text", x = 11, y = 0.02, label = "Brown v. Board of Education,\n347 U.S. 483 (1954)", fontface = "italic", hjust = 0) +
  scale_linetype_manual(values = c("25347" = "solid", "21109" = "dashed")) +
  scale_x_continuous(breaks = seq(0, 30, by = 5),
                     limits = c(0, 30)) +
  scale_y_continuous(limits = c(0, 0.065)) +
  theme_classic() +
  theme(
    legend.position = "none",
    panel.border = element_rect(
    color = "black", fill = NA)
    )
```

## Fig. 10

```{r}
# Combine authority scores into a data frame for plotting
authority_scores_df <- do.call(rbind, lapply(names(authority_scores_by_year), function(year) {
  scores <- authority_scores_by_year[[year]]
  data.frame(
    year = as.numeric(year),
    case_id = names(scores),
    authority_score = scores
  )
}))

# Filter for the specific case IDs of interest
filtered_df <- authority_scores_df[authority_scores_df$case_id %in% fig10_ids, ]

# Plot authority scores over time
ggplot(filtered_df, aes(x = year, y = authority_score, linetype = case_id)) +
  geom_line() +
  labs(
    title = "",
    x = "Year",
    y = "Authority Score"
  ) +
  annotate("text", x = 1945, y = 0.04, label = "Brown v. Mississippi,\n297 U.S. 278 (1936)",
           fontface = "italic", hjust = 0) +
  annotate("text", x = 1985, y = 0.05, label = "Miranda v. Arizona,\n384 U.S. 436 (1966)",
           fontface = "italic", hjust = 0) +
  annotate("text", x = 1973, y = 0.02, label = "Escobedo v. Illinois,\n378 U.S. 478 (1964)",
           fontface = "italic", hjust = 0) +
  annotate("text", x = 1984, y = 0.01, label = "Rhode Island v. Innis,\n446 U.S. 291 (1980)",
           fontface = "italic", hjust = 0) +
  labs(
    x = "Year",
    y = "Authority Score",
    title = "5th Amendment"
  ) +
  scale_linetype_manual(values = c("18501" = "dotted", "23115" = "dashed",
                                   "23601" = "solid", "26918" = "dotdash")) +
  scale_x_continuous(breaks = seq(1940, 2000, by = 10), limits = c(1940, 2000)) +
  theme_classic() +
  theme(
    legend.position = "none",
    panel.border = element_rect(
    color = "black", fill = NA)
    )
```

